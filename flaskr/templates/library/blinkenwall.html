<body>
  {% if post['type'] == "SHADERTOY" %}
  <iframe class="uri background offset"  allowtransparence="true" width="192" height="146" frameborder="0" src="{{ post['uri'] }}?gui=false&paused=false&muted=true" allowfullscreen></iframe>
{% endif %}
{% if post['type'] == "YOUTUBE" %}
  <iframe class="uri background"  allowtransparence="true" width="192" height="144" frameborder="0" src="{{ post['uri'] }}?autoplay=1&loop=1&controls=0&mute=1" allowfullscreen allow="autoplay"></iframe>
{% endif %}
{% if post['type'] == "GIF" %}
  <img class="uri background" src="{{UPLOAD_FOLDER + '/'}}{{ post['id'] }}" width="192" height="144">
{% endif %}
</body>
<style>

.background {
  position: fixed;
  top: -2;
  left: 0;
  pointer-events: none;
}
.offset {
  z-index: -1;
}

iframe {
  position: relative;
  opacity: 0.5;
}
body {
  background-color: black
}
</style>
<script>
  const currentID = Number("{{ post['id'] }}");
 //todo set timeout
  function webrequest(){
    fetch('/blinkenwall/id')
     .then(r => r.json())
     .then(jsonresponse => {
      console.log(jsonresponse['id']);
      const responceID = jsonresponse['id'];
      if (responceID != currentID)
        location.reload(true)
     })
     .catch(err => console.error(err));
  }

webrequest();

 setInterval(() => {
  webrequest();
 }, 5000)
  /*wait();



async function wait() {
    await setTimeout(5000);
  };
  
  async function getJSON() {
    return fetch('/blinkenwall/id')
        .then((response)=>response.json())
        .then((responseJson)=>{return responseJson});
}

  async function caller() {
    const json = await this.getJSON();  
    return Number(json);           
}
wait();
getJSON();

 if (caller() != currentID){
    console.log(currentID)
 }
  while (true) {
    


    (async () => {
  const rawResponse = await fetch('/blinkenwall/id', {
    method: 'GET',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    }
  });
  const content = await rawResponse.json();

    if (content['id'] != currentID){
      
    }
    
  })();
}*/
    
  

</script>
